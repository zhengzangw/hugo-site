---
title: Multimedia
date: 2019-01-28
tags: [notes, network]
weight: 7
---



# QoS

## Y.1291 框架

### 数据平面

* 队列管理算法：适当的时候丢弃分组来管理分组队列
* 排队和调度算法
* 拥塞避免
* 分组标记
* 通信量分类
* 通信量管制
* 通信量整形

### 控制平面

* 准入控制
* QoS路由选择
* 资源预留

### 管理平面

* 服务级别协约
* 通信量度量和记录
* 通信量恢复
* 策略

## 服务级别协约 (SLA)

网络提供者与客户之间的一份合约，规定向客户提供的具体服务内容

* 对将要提供的服务本质的描述
* 希望获得的服务性能级别
* 对服务级别的监视和报告处理过程

## 综合服务体系结构 ISA (RFC 1633)

* 尽最大努力服务机制
  * 路由选择算法
  * 分组丢弃
* 流：由相关IP分组构成的一个可区分的分组流，它是由单个用户活动产生的，并且要求相同的服务质量
* ISA功能
  * 路由选择算法
  * 丢弃策略
  * 准入控制
  * 排队策略
    * 公平排队策略
    * 加权公平排队
* ISA 服务类型
  * 保证服务
    * 提供保证的容量级别或数据率
    * 对排队时延指明上限
    * 没有排队损失
  * 受控服务
    * 和在网络无负载条件下雨尽最大努力服务相似
    * 排队时延不会明显超过某个最小传输时延
    * 几乎没有排队丢失
  * 尽最大努力服务

## RSVP 资源预约协议 (RFC 2205)

* 接受者发起预约
* 软状态：无连接的方法，预约状态是缓存在路由器中的信息，由终端系统装载并周期性地刷新
* 会话：目的IP地址+IP协议标识符+目的端口
* 流描述符：目的端系统发起的预约=流规约+过滤器规约
* 流规约：指明了所希望的服务质量=服务类别+RSpec（定义QoS）+TSpec（描述数据流）
* 过滤器规约：请求预约的分组集合=源地址+UDP/TCP源端口

## 区分服务 (DS, RFC 2475)

* DS 码点 (6bits)：
  * xxxxx0：留作标准设置使用
    * 000000：默认分组类别，尽最大努力转发
    * xxx000： 为向下兼容 IPv4 保留，提供至少等同于 IPv4 优先级功能提供的服务
  * xxxx11：留作实验或本地使用
  * xxxx01：将来可能分配
* 每跳行为(PHB)
  * 快速转发
  * 确认转发

# MPLS 多协议标记交换

* 用来提供面向连接的且具有类似区分服务所提供的服务特征的QoS，支持流量管理以提高网络吞吐量，并保持基于IP组网方案的灵活性（2.5层）
  * 服务质量支持
  * 流量工程：动态地定义路由，在需求已知的情况下规划资源投入，优化网络的使用之类的能力
  * 支持虚拟专用网络
  * 多协议支持

| 术语           |                              |     |                                                |
| -------------- | ---------------------------- | --- | ---------------------------------------------- |
| 标记交换路由器 | Label Switching Router       | LSR |                                                |
| 转发等价类     | Forwarding Equivalence Class | FEC | 一组以相同方式转发的分组                       |
| 标记交换通路   | Label Switched Path          | LSP | 一定特定的FEC的所有分组经过一个或多个LSR的路径 |
| 标记信息库     | Label Information Base       | LIB | LSR用以指明一个分组如何被处理的表              |
| MPLS 域        |                              |     | 一个相互连接的支持MPLS路由器的集合             |

* 标记
  * 标记紧跟在数据链路层首部后面（栈顶），但在任何网络层首部之前（栈底）

| 标记值                       | 流量类别 (TC) | 栈底比特(S) | TTL |
| ---------------------------- | ------------- | ----------- | --- |
| 20bits                       | 3             | 1           | 8   |
| 仅有本地意义20比特，0~15保留 |               | 栈底置1     |     |

## LDP 标记分发协议 (Label Distribution Protocal, RFC 5036)

* 报文类型
  * 发现：LSR周期性发送 Hello 报文指示存在
  * 会话建立和维持
  * 通告：创建、更改和删除 FEC 标记映射
  * 通知报文
    * 差错通知
    * 建议通知
* LDP 报文 = 首部+多个报文
* 首部

| 版本 | PDU 长度 | LDP 表示符        |
| ---- | -------- | ----------------- |
| 1    |          | 标志 LSR 的唯一性 |

* 报文

| U比特                                        | 报文类型         | 报文长度 | 报文ID | 必选参数 | 可选参数 |
| -------------------------------------------- | ---------------- | -------- | ------ | -------- | -------- |
| 指示如何处理一个位置类型的报文（转发或丢弃） | 识别特定报文类型 |          |        |          |

## VPN (基于MPLS)

* 客户边缘(CE)：连接到 MPLS 网络的客户设备
* 提供者边缘(PE)：MPLS 边缘路由器
* 附着电路(AC)：CE和PE 间工作在链路层的链路
* Layer 2 VPN(L2VPN)：基于链路层地址
* Layer 3 VPN(L3VPN)：基于IP地址


