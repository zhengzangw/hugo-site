---
title: Spatial Domain
date: 2019-09-02
tags: [ml, notes]
weight: 2
---

## 基本概念

-   相邻像素
    -   八邻域
    -   四邻域
    -   四对角邻域
-   定义邻接性的灰度值集合：$V$
    -   二值/非二值
    -   $V$ 可以把灰度级化成两个等价类
-   邻接性
    -   4 邻接：$p\in N_4(p)$ 且 $p,q$ 的灰度值都属于 $V$
    -   8 邻接：$p\in N_8(p)$ 且 $p,q$ 的灰度值都属于 $V$
    -   $m$邻接（混合邻接）：$p,q$ 的灰度值都属于 $V$
        -   $q\in N_4(p)$
        -   或 八邻域且四邻域交集内无灰度值属于 $V$
        -   消除二义性
-   连通性：通路
    -   起点终点相同：闭合通路
-   连通集/连通分量
-   区域：像素子集 $R$ 是连通集
    -   邻接
    -   $K$ 个不邻接的区域：前景
    -   补集：背景
    -   边界：有一个背景邻点（使用 8 连通）
    -   边缘：具有某些导数值的像素形成，“局部”概念
        -   二值图像：边界=边缘
-   距离
    -   欧式 $D_r$
    -   曼哈顿距离 $D_4$
    -   棋盘距离 $D_8=\max(|x-s|,|y-t|)$

## 算术/逻辑/集合操作增强

主要以像素对像素为基础在两幅或多幅图像间进行

-   算术操作
    -   加：$g(x,y)=f(x,y)+h(x,y)$
        -   定理：对$M$幅加性噪声图像进行平均，可以使图像的平方信噪比提高$M$倍
    -   减：$g(x,y)=f(x,y)-h(x,y)$
        -   找不同
        -   指纹抽取
        -   掩膜式 X 光成像法
        -   负值：规范化 $y=\frac{x-\min}{\max-\min}\times 255$
    -   乘：$g(x,y)=f(x,y)h(x,y)$
        -   掩膜运算
    -   除
        -   归一化
-   集合操作：灰度图像集合 $A$
    -   元素：$(x,y,z)$
        -   空间坐标，灰度
    -   $A^c=\{(x,y,K-z)|(x,y,z)\in A\}$
        -   $K=2^k-1$ 为灰度级数
    -   $A\cup B=\{\max\limits_z(a,b)|a\in A, b\in B\}$
-   逻辑操作：二值图像（前景 1，背景 0）
    -   OR, AND, NOT, XOR

## 几何变换

### 空间变换算法

像素空间位置的变换

-   保持图像中曲线特征的连续性（相邻输入产生相邻输出）
-   仿射变换(Affine Transformation)

    -   $x=t_{11}v+t_{21}w+t_{31}$
    -   $y=t_{12}v+t_{22}w+t_{32}$
        -   $t_{11},t_{22}$: 伸缩比例
        -   $t_{12},t_{21}$: 倾斜程度
        -   $t_{13},t_{31}$: 平移量
    -   矩阵形式：$[x,y,1]=[v,w,1]T,T=[t_{11},t_{12},0;t_{21},t_{22},0;t_{31},t_{32},0]$
        -   $[x,y,1]=[v,w,1]T_1T_2\cdots$
        -   基本变换矩阵都可逆

| 基本仿射变换   | $x$                       | $y$                       |
| -------------- | ------------------------- | ------------------------- |
| 恒等变换       | $v$                       | $w$                       |
| 伸缩变换       | $c_xv$                    | $c_yw$                    |
| 旋转变换       | $v\cos\theta-w\sin\theta$ | $v\sin\theta+w\cos\theta$ |
| 平移变换       | $v+t_x$                   | $w+t_y$                   |
| (水平)倾斜变换 | $v$                       | $s_hv+w$                  |
| (垂直)倾斜变换 | $v+s_vw$                  | $w$                       |

-   图像配准
    -   匹配点 $P=[v_0,w_0,1;\cdots],Q$
    -   最优仿射变换：$Q=PT$
        -   最小二乘 $\min\limits_T\lVert Q-PT\rVert_F^2$
    -   双线性近似：8 个参数，4 个约束点，求解方差

### 灰度内插算法

确定变换后图像的像素灰度级

-   前向映射：将输入图像灰度值分配给相邻四个网格位
-   反向映射：根据输入图像相邻四个像素的灰度值计算该位置灰度值
    -   最近邻内插
    -   线性内插：$f(x)=\frac{x_2-x}{x_2-x_1}f(x_1)+\frac{x_1-x}{x_1-x_2}f(x_2)$
    -   双线性内插
        -   $Q_{11}Q_{12}\rightarrow R_1,Q_{21}Q_{22}\rightarrow R_2,R_1R_2\rightarrow P$
        -   $f(x,y)\approx a_0+a_1x+a_2y+a_3xy$ 找 $4$ 个最近点求解方程组
    -   双三次内插
        -   最邻近 $4$ 点，$f,\frac{\partial f}{\partial x}, \frac{\partial f}{\partial y}, \frac{\partial f^2}{\partial x\partial y}$ 每个建立四个方程求解
        -   $p(x,y)=\sum_{i=0}^3\sum_{j=0}^3a_{ij}x^iy^j$，找 $16$ 个最近点求解方差

## 灰度变换

单像素操作，邻域大小为 1 的空间滤波 $s=T(r)$

-   对比度拉伸函数
-   阈值处理函数
-   基本函数：
    -   线性，反转
        -   图像反转：$S=L-1-r,L=2^b$ 凸显白色灰色
    -   对数，反对数
        -   $s=c\log(1+r)$：低灰度拉伸，高灰度拉伸
    -   幂律函数（伽马变换）
        -   $s=cr^\gamma$：$\gamma$ 小，对比度降低，细节增加
-   分段函数
    -   对比拉伸变换：单调递增
    -   灰度级分层
-   比特平面分层
    -   高阶比特平面包含视觉上重要的数据
    -   低比特位贡献精细细节
    -   图像压缩
-   直方图处理
    -   横坐标：灰度级
    -   纵坐标：出现的频率
    -   阈值面积函数(AD) $A(D)=\int_D^\infty H(p)dp$
        -   $H(D)=A(D)-A(D+1)$
    -   概率密度函数 PDF：$P(D)=\frac{1}{A_0}H(D)$
    -   离散直方图：$p_r(r_k)=\frac{n_k}{MN}$
    -   应用
        -   图像快速处理
        -   分隔前景背景
            -   双峰直方图
        -   面积计算

### 直方图均衡化

-   单调连续灰度变换函数 $s=T(r)$
-   输入密度 $p_r(r)$, 输出密度 $p_s(s)=p_r(r)|\frac{dr}{ds}|=p_r(T^{-1}(s))\frac{1}{|T'(T^{-1}(s))|}$
-   变换函数：$s=T(r)=(L-1)\int_0^rp_r(w)dw$
    -   属于区间 $[0,L-1]$
    -   变换为均匀分布
-   $s_k=T(r_k)=(L-1)\sum_{j=0}^kp_r(r_j)=\frac{L-1}{MN}\sum_{j=0}^kn_j$
-   直方图匹配： A->B->C
    -   求变换函数 $s=T(r)$
    -   求变换函数 $s=G(z)$
    -   求逆 $z=G^{-1}(s)=G^{-1}(T(r))$
-   局部直方图均衡化：定义邻域，不断平移中心位置
-   直方图统计量用于局部图像增强
    -   $n$阶矩：$\mu_n(r)=\sum_{i=0}^{L-1}(r_i-m)^np(r_i)$
        -   2 阶矩：方差$\sigma$
        -   均值 $m$
    -   $g(x,y)=$
        -   $Ef(x,y)$ if $m_{S_{xy}}\leq k_0m_G$ and $k_1\sigma_G\leq\sigma_{S_{xy}}\leq k_2\sigma_{G}$
        -   $f(x,y)$ otherwise

## 空间滤波

邻域、预定义的操作

-   $m\times n$ 的模板
    -   最小 $3\times 3$
-   边界：忽略/填充
-   $g(x,y)=T(f(x,y))$：$T$为操作算子，定义在$(x,y)$的邻域上
    -   线性：$g(x,y)=\sum_{s=-a}^a\sum_{t=-b}^bw(s,t)f(x+s,y+t)$
-   Correlation 相关：平移滤波器模板，计算每个位置乘积直和
    -   离散单位脉冲颠倒
    -   $w(x,y)\star f(x,y)=\sum_{s=-a}^a\sum_{t=-b}^bw(s,t)f(x+s,y+t)$
    -   归一化后寻找匹配：$R=\vec w^T\vec z$
-   Convolution 卷积：相关中滤波器旋转 180 度
    -   $w(x,y)\star f(x,y)=\sum_{s=-a}^a\sum_{t=-b}^bw(s,t)f(x-s,y-t)$
-   离散微分
    -   $\frac{\partial f}{\partial x}=f(x+1) - f(x)$
        -   较粗的边缘
    -   $\frac{\partial^2 f}{\partial x^2}=f(x+1) + f(x-1) - 2f(x)$
        -   由零分开，单像素宽
    -   拉普拉斯算子：$\nabla^2f=\frac{\partial^2 f}{\partial x^2}+\frac{\partial^2 f}{\partial y^2}$
        -   离散拉普拉斯算子
            -   $\frac{\partial^2 f}{\partial x^2}=f(x+1, y) + f(x-1, y) - 2f(x,y)$
            -   $\frac{\partial^2 f}{\partial y^2}=f(x, y+1) + f(x, y-1) - 2f(x,y)$
        -   标准形式：$[0,1,0;1,-4,1;0,1,0]$
        -   对角形式：$[1,1,1;1,-8,1;1,1,1]$
    -   梯度：$\nabla f$
        -   $M(x,y)=|\nabla f|=\sqrt{g_x^2+g_y^2}\approx |g_x|+|g_y|$
        -   罗伯特交叉梯度算子 $g_x:[-1,0;0,1], g_y:[0,1;-1,0]$
        -   Sobel 算子：$g_x:[-1,-2,-1;,0,0,0;,1,2,1], g_y:[-1,0,1;-2,0,2;-1,0,1]$
        -   阈值检测边缘
-   各向同性滤波器：旋转不变性

| 滤波器           | 模板                                                                                          | 优点                 | 缺点                           |                  |
| ---------------- | --------------------------------------------------------------------------------------------- | -------------------- | ------------------------------ | ---------------- |
| 平滑线性滤波器   | $\frac{1}{9}\sum_{i}z_i$                                                                      | 降低噪声             | 边缘模糊，小物体缺失，边界明显 | 先求和，再归一化 |
| 加权线性滤波器   | e.g. 二维高斯分布                                                                             | 非均匀权重，降低模糊 |                                |                  |
| 非线性平滑滤波器 | 中值，最大值，最小值                                                                          | 稳定                 |                                |                  |
| 锐化滤波器       | $g(x,y)=f(x,y)+c[\nabla^2f(x,y)]$                                                             |                      |                                |                  |
| 非锐化掩蔽       | $g_{\text{mask}(x,y)}=f(x,y)-\overline{f}(x,y)$, $g(x,y)=f(x,y)+k\star g_{\text{mask}}(x,y)]$ |                      |                                | $k=1$            |
| 高提升滤波       |                                                                                               |                      |                                | $k>1$            |
| 梯度边缘检测     |                                                                                               |                      |                                | $M(x,y)$         |

## Edge Preserving Filters 保边滤波器

- 双边滤波器（Bilateral）
  - 高斯平滑滤波：$g_1(i,j)=\frac{\sum_{k,l}f(k,l)*d(i,j,k,l)}{\sum_{k,l}d(i,j,k,l)}$
    - $d(i,j,k,l)= e^{-\frac{(i-k)^2+(j-l)^2}{2\sigma_d^2}}$
  - 值域高斯滤波：$g_2(i,j)=\frac{\sum_{k,l}f(k,l)*r(i,j,k,l)}{\sum_{k,l}r(i,j,k,l)}$
    - $r(i,j,k,l)=e^{-\frac{\lVert f(i,j)-f(k,l)\rVert^2}{2\sigma_r^2}}$
    - 两个像素物理距离越大则权值越小，反之则权值越大
  - 双边滤波器：$\frac{\sum_{k,l}f(k,l)*w(i,j,k,l)}{\sum_{k,l}w(i,j,k,l)}$
    - $w(i,j,k,l)=e^{-\frac{(i-k)^2+(j-l)^2}{2\sigma_d^2}-\frac{\lVert f(i,j)-f(k,l)\rVert^2}{2\sigma_r^2}}$
- 引导滤波器：快速双边滤波器
- [递归域变换滤波器](chenyuhui@lamda.nju.edu.cn)
